<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <%= title %> - Ù…Ù†ØµØ© ØªØ±Ø§Ø®ÙŠØµ Ø¨Ø­ÙŠØ±Ø© Ø§Ù„Ø¨Ø±Ø¯ÙˆÙŠÙ„
  </title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="icon" type="image/png" href="/imgs/logo.png">
</head>

<body>
  <%- include('../partials/spinner') %>
    <%- include('../partials/navbar') %>

      <div class="details-page">
        <div class="container">
          <!-- Breadcrumb -->
          <div class="breadcrumb">
            <a href="/dashboard"><i class="fas fa-home"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
            <span>/</span>
            <span>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</span>
          </div>

          <div class="page-header">
            <div class="header-info">
              <h1><i class="fas fa-file-alt"></i> Ø·Ù„Ø¨ Ø±Ù‚Ù… <%= application.applicationNumber %>
              </h1>
              <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…: <%= new Date(application.createdAt).toLocaleDateString('ar-EG') %>
              </p>
            </div>
            <%- include('../partials/status-badge', { status: application.status, statusInfo: application.statusInfo })
              %>
          </div>

          <div class="content-grid">
            <!-- Application Info -->
            <div class="card info-card">
              <h3><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
              <div class="info-grid">
                <div class="info-item">
                  <span class="label">Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ</span>
                  <span class="value">
                    <% if (application.applicationType==='fisherman' ) { %>
                      <i class="fas fa-fish text-primary"></i> ØªØ±Ø®ÙŠØµ ØµÙŠØ§Ø¯
                      <% } else if (application.applicationType==='boat' ) { %>
                        <i class="fas fa-ship text-accent"></i> ØªØ±Ø®ÙŠØµ Ù…Ø±ÙƒØ¨
                        <% } else if (application.applicationType==='vehicle' ) { %>
                          <i class="fas fa-truck text-warning"></i> ØªØ±Ø®ÙŠØµ Ø³ÙŠØ§Ø±Ø©
                          <% } else if (application.applicationType==='trade' ) { %>
                            <i class="fas fa-store text-purple"></i> ØªØ±Ø®ÙŠØµ ØªØ¬Ø§Ø±Ø©
                            <% } else if (application.applicationType==='entry' ) { %>
                              <i class="fas fa-door-open text-muted"></i> ØªØ±Ø®ÙŠØµ Ø¯Ø®ÙˆÙ„
                              <% } else { %>
                                <%= application.applicationType %>
                                  <% } %>
                  </span>
                </div>
                <div class="info-item">
                  <span class="label">Ø§Ù„ÙØ¦Ø©</span>
                  <span class="value">
                    <%= application.licenseCategory %>
                  </span>
                </div>
                <div class="info-item">
                  <span class="label">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</span>
                  <span class="value">
                    <%= application.isRenewal ? 'ØªØ¬Ø¯ÙŠØ¯' : 'Ø¬Ø¯ÙŠØ¯' %>
                  </span>
                </div>
                <% if (application.paymentAmount) { %>
                  <div class="info-item">
                    <span class="label">Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ø³ÙˆÙ…</span>
                    <span class="value">
                      <%= application.paymentAmount %> Ø¬Ù†ÙŠÙ‡
                    </span>
                  </div>
                  <% } %>
              </div>
            </div>

            <!-- Status Timeline -->
            <div class="card timeline-card">
              <h3><i class="fas fa-history"></i> Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø·Ù„Ø¨</h3>
              <div class="timeline">
                <!-- Step 1: ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ -->
                <div class="timeline-item active">
                  <div class="timeline-dot" style="background: #4CAF50;"><i class="fas fa-check"
                      style="font-size: 10px; color: white;"></i></div>
                  <div class="timeline-content">
                    <span class="timeline-date">
                      <%= new Date(application.createdAt).toLocaleDateString('ar-EG') %>
                    </span>
                    <p><strong>ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</strong></p>
                  </div>
                </div>

                <!-- Step 2: Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
                <% if (['under_review', 'approved_payment_pending' , 'payment_verified' , 'ready' , 'completed'
                  ].includes(application.status) || application.reviewedAt) { %>
                  <div class="timeline-item">
                    <div class="timeline-dot" style="background: #4CAF50;"><i class="fas fa-check"
                        style="font-size: 10px; color: white;"></i></div>
                    <div class="timeline-content">
                      <span class="timeline-date">
                        <%= application.reviewedAt ? new Date(application.reviewedAt).toLocaleDateString('ar-EG') : ''
                          %>
                      </span>
                      <p><strong>ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</strong></p>
                    </div>
                  </div>
                  <% } else if (application.status==='received' ) { %>
                    <div class="timeline-item">
                      <div class="timeline-dot" style="background: #e0e0e0;"></div>
                      <div class="timeline-content">
                        <p style="color: #9e9e9e;">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                      </div>
                    </div>
                    <% } %>

                      <!-- Step 3: ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© -->
                      <% if (['approved_payment_pending', 'payment_verified' , 'ready' , 'completed'
                        ].includes(application.status) || application.approvedAt) { %>
                        <div class="timeline-item">
                          <div class="timeline-dot" style="background: #4CAF50;"><i class="fas fa-check"
                              style="font-size: 10px; color: white;"></i></div>
                          <div class="timeline-content">
                            <span class="timeline-date">
                              <%= application.approvedAt ? new Date(application.approvedAt).toLocaleDateString('ar-EG')
                                : '' %>
                            </span>
                            <p><strong>ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨</strong></p>
                          </div>
                        </div>
                        <% } else if (application.status !=='rejected' && (application.status==='received' ||
                          application.status==='under_review' )) { %>
                          <div class="timeline-item">
                            <div class="timeline-dot" style="background: #e0e0e0;"></div>
                            <div class="timeline-content">
                              <p style="color: #9e9e9e;">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</p>
                            </div>
                          </div>
                          <% } %>

                            <!-- Step 4: Ø§Ù„Ø¯ÙØ¹ -->
                            <% if (['payment_verified', 'ready' , 'completed' ].includes(application.status) ||
                              application.paymentVerifiedAt) { %>
                              <div class="timeline-item">
                                <div class="timeline-dot" style="background: #4CAF50;"><i class="fas fa-check"
                                    style="font-size: 10px; color: white;"></i></div>
                                <div class="timeline-content">
                                  <span class="timeline-date">
                                    <%= application.paymentVerifiedAt ? new
                                      Date(application.paymentVerifiedAt).toLocaleDateString('ar-EG') : '' %>
                                  </span>
                                  <p><strong>ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­ ğŸ’°</strong></p>
                                </div>
                              </div>
                              <% } else if (application.status==='approved_payment_pending' ) { %>
                                <div class="timeline-item">
                                  <div class="timeline-dot" style="background: #ff9800; animation: pulse 2s infinite;">
                                    <i class="fas fa-clock" style="font-size: 10px; color: white;"></i>
                                  </div>
                                  <div class="timeline-content">
                                    <p style="color: #ff9800;"><strong>ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¯ÙØ¹...</strong></p>
                                  </div>
                                </div>
                                <% } else if (!['rejected', 'received' , 'under_review' ].includes(application.status))
                                  { %>
                                  <div class="timeline-item">
                                    <div class="timeline-dot" style="background: #e0e0e0;"></div>
                                    <div class="timeline-content">
                                      <p style="color: #9e9e9e;">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¯ÙØ¹</p>
                                    </div>
                                  </div>
                                  <% } %>

                                    <!-- Step 5: Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… / Ù…ÙƒØªÙ…Ù„ -->
                                    <% if (application.status==='ready' || application.status==='completed' ) { %>
                                      <div class="timeline-item">
                                        <div class="timeline-dot" style="background: #2196F3;"><i class="fas fa-gift"
                                            style="font-size: 10px; color: white;"></i></div>
                                        <div class="timeline-content">
                                          <p><strong>
                                              <%= application.status==='completed' ? 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø®ØµØ© âœ…'
                                                : 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… ğŸ“¦' %>
                                            </strong></p>
                                        </div>
                                      </div>
                                      <% } else if (['payment_verified'].includes(application.status)) { %>
                                        <div class="timeline-item">
                                          <div class="timeline-dot" style="background: #e0e0e0;"></div>
                                          <div class="timeline-content">
                                            <p style="color: #9e9e9e;">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ¬Ù‡ÙŠØ² (7-12 ÙŠÙˆÙ…)</p>
                                          </div>
                                        </div>
                                        <% } %>

                                          <!-- Rejected Status -->
                                          <% if (application.status==='rejected' ) { %>
                                            <div class="timeline-item">
                                              <div class="timeline-dot" style="background: #f44336;"><i
                                                  class="fas fa-times" style="font-size: 10px; color: white;"></i></div>
                                              <div class="timeline-content">
                                                <p style="color: #f44336;"><strong>ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ âŒ</strong></p>
                                                <% if (application.rejectionReason) { %>
                                                  <p style="font-size: 0.85rem; color: #757575;">
                                                    <%= application.rejectionReason %>
                                                  </p>
                                                  <% } %>
                                              </div>
                                            </div>
                                            <% } %>
              </div>
            </div>

            <!-- Personal/Submitted Data -->
            <div class="card data-card">
              <h3><i class="fas fa-user"></i> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</h3>
              <div class="info-grid">
                <!-- User Info (Always visible) -->
                <div class="info-item">
                  <span class="label">Ø§Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</span>
                  <span class="value">
                    <%= user.firstNameAr %>
                      <%= user.lastNameAr %>
                  </span>
                </div>
                <div class="info-item">
                  <span class="label">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</span>
                  <span class="value">
                    <%= user.nationalId %>
                  </span>
                </div>
                <div class="info-item">
                  <span class="label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</span>
                  <span class="value">
                    <%= user.phone %>
                  </span>
                </div>

                <% if (application.data) { %>
                  <% const data=typeof application.data==='string' ? JSON.parse(application.data) : application.data; %>

                    <!-- Fisherman Fields -->
                    <% if (data.unionCardNumber) { %>
                      <div class="info-item">
                        <span class="label">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ù‚Ø§Ø¨ÙŠØ©</span>
                        <span class="value">
                          <%= data.unionCardNumber %>
                        </span>
                      </div>
                      <% } %>

                        <% if (data.marina) { %>
                          <div class="info-item">
                            <span class="label">Ø§Ù„Ù…Ø±Ø³Ù‰</span>
                            <span class="value">
                              <%= data.marina %>
                            </span>
                          </div>
                          <% } %>

                            <% if (data.previousLicenseNumber) { %>
                              <div class="info-item">
                                <span class="label">Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</span>
                                <span class="value">
                                  <%= data.previousLicenseNumber %>
                                </span>
                              </div>
                              <% } %>

                                <!-- Boat Fields -->
                                <% if (data.boatNumber) { %>
                                  <div class="info-item">
                                    <span class="label">Ø±Ù‚Ù… Ø§Ù„ØµØ§Ù„</span>
                                    <span class="value">
                                      <%= data.boatNumber %>
                                    </span>
                                  </div>
                                  <% } %>
                                    <% if (data.boatRegistration) { %>
                                      <div class="info-item">
                                        <span class="label">Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨</span>
                                        <span class="value">
                                          <%= data.boatRegistration %>
                                        </span>
                                      </div>
                                      <% } %>
                                        <% if (data.boatLength) { %>
                                          <div class="info-item">
                                            <span class="label">Ø·ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨</span>
                                            <span class="value">
                                              <%= data.boatLength %> Ù…ØªØ±
                                            </span>
                                          </div>
                                          <% } %>
                                            <% if (data.enginePower) { %>
                                              <div class="info-item">
                                                <span class="label">Ù‚ÙˆØ© Ø§Ù„Ù…Ø­Ø±Ùƒ</span>
                                                <span class="value">
                                                  <%= data.enginePower %> Ø­ØµØ§Ù†
                                                </span>
                                              </div>
                                              <% } %>
                                                <% if (data.plateNumber) { %>
                                                  <div class="info-item">
                                                    <span class="label">Ø±Ù‚Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</span>
                                                    <span class="value">
                                                      <%= data.plateNumber %>
                                                    </span>
                                                  </div>
                                                  <% } %>
                                                    <% if (data.vehicleModel) { %>
                                                      <div class="info-item">
                                                        <span class="label">Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</span>
                                                        <span class="value">
                                                          <%= data.vehicleModel %>
                                                        </span>
                                                      </div>
                                                      <% } %>
                                                        <% if (data.previousBoatNumber) { %>
                                                          <div class="info-item">
                                                            <span class="label">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ÙƒØ¨ ÙÙŠ Ø§Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
                                                            <span class="value">
                                                              <%= data.previousBoatNumber %>
                                                            </span>
                                                          </div>
                                                          <% } %>
                                                            <% } else { %>
                                                              <p style="color: #757575;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</p>
                                                              <% } %>
              </div>
            </div>

            <!-- Documents -->
            <% if (application.documents && application.documents.length> 0) { %>
              <div class="card documents-card">
                <h3><i class="fas fa-file-alt"></i> Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©</h3>
                <div class="documents-list">
                  <% application.documents.forEach(doc=> {
                    let docPath = doc.filePath || '';
                    docPath = docPath.replace(/\\/g, '/');
                    if (docPath.startsWith('src/public/')) docPath = docPath.replace('src/public/', '/');
                    else if (docPath.startsWith('public/')) docPath = docPath.replace('public/', '/');
                    if (!docPath.startsWith('/')) docPath = '/' + docPath;

                    // Fallback using filename if path is empty/invalid
                    if ((docPath === '/' || docPath === '') && doc.fileName) {
                    docPath = '/uploads/' + doc.fileName;
                    }
                    %>
                    <div class="document-item">
                      <div class="doc-info">
                        <i class="<%= doc.mimeType === 'application/pdf' ? 'fas fa-file-pdf' : 'fas fa-image' %>"></i>
                        <span>
                          <%= doc.originalName || doc.fileName %>
                        </span>
                      </div>
                      <a href="<%= docPath %>" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                      </a>
                    </div>
                    <% }); %>
                </div>
              </div>
              <% } %>
                <% if (application.rejectionReason) { %>
                  <!-- Rejection Reason -->
                  <div class="card rejection-card">
                    <h3><i class="fas fa-exclamation-triangle"></i> Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶</h3>
                    <p>
                      <%= application.rejectionReason %>
                    </p>
                  </div>
                  <% } %>
          </div>

          <!-- Payment Required Section -->
          <% if (application.status==='approved_payment_pending' ) { %>
            <div class="payment-required-card">
              <div class="payment-icon">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="payment-info">
                <h3>Ù…Ø·Ù„ÙˆØ¨ Ø¯ÙØ¹ Ø§Ù„Ø±Ø³ÙˆÙ…</h3>
                <p>ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ. ÙŠØ±Ø¬Ù‰ Ø¯ÙØ¹ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª.</p>
                <% if (application.paymentAmount) { %>
                  <div class="payment-amount">
                    <span class="amount">
                      <%= application.paymentAmount %>
                    </span>
                    <span class="currency">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ</span>
                  </div>
                  <% } %>

                    <div class="bank-info"
                      style="margin-top: 1.5rem; padding: 1rem; background: #e3f2fd; border-radius: 8px; border: 1px solid #90caf9;">
                      <p style="margin-bottom: 0.5rem; font-weight: 600; color: #1565c0; font-size: 0.9rem;">Ø­Ø³Ø§Ø¨ Ø¬Ù‡Ø§Ø²
                        Ù…Ø³ØªÙ‚Ø¨Ù„ Ù…ØµØ± Ù„Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù…Ù‡ Ù„Ù„ØªØ­ÙˆÙŠÙ„:</p>
                      <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
                        <p
                          style="font-family: monospace; font-size: 1.1rem; font-weight: 700; color: #0d47a1; margin: 0; direction: ltr;">
                          5170199000001735</p>
                        <button onclick="navigator.clipboard.writeText('5170199000001735')"
                          style="background: white; border: 1px solid #bbdefb; border-radius: 4px; padding: 4px 8px; cursor: pointer; color: #1565c0;">
                          <i class="fas fa-copy"></i>
                        </button>
                      </div>
                    </div>
              </div>
              <div class="payment-actions">
                <a href="/payment/<%= application.id %>" class="btn btn-pay">
                  <i class="fas fa-upload"></i> Ø±ÙØ¹ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø³Ø¯Ø§Ø¯
                </a>
                <p class="payment-note">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¯ÙØ¹ ÙˆØ±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„</p>
              </div>
            </div>
            <% } %>

              <!-- Status Messages -->
              <% if (application.status==='payment_verified' ) { %>
                <div class="status-message success">
                  <i class="fas fa-check-circle"></i>
                  <p>ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø®ØµØ©...</p>
                </div>
                <% } else if (application.status==='ready' ) { %>
                  <div class="status-message ready">
                    <i class="fas fa-gift"></i>
                    <p>Ø§Ù„Ø±Ø®ØµØ© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ù„Ù…Ù‚Ø± Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø®ØµØªÙƒ.</p>
                  </div>
                  <% } else if (application.status==='completed' ) { %>
                    <div class="status-message completed">
                      <i class="fas fa-trophy"></i>
                      <p>ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø±Ø®ØµØ© Ø¨Ù†Ø¬Ø§Ø­. Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù…Ù†ØµØªÙ†Ø§!</p>
                    </div>
                    <% } %>

                      <div class="actions-bar">
                        <a href="/dashboard" class="btn btn-outline-primary">
                          <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                        </a>
                      </div>
        </div>
      </div>

      <%- include('../partials/footer') %>

        <style>
          .details-page {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
            background: #FAFAFA;
          }

          .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 0.9375rem;
            color: #757575;
          }

          .breadcrumb a {
            color: #1e3c72;
            text-decoration: none;
          }

          .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
          }

          .header-info h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #212121;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
          }

          .header-info h1 i {
            color: #1e3c72;
          }

          .header-info p {
            color: #757575;
          }

          .content-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
          }

          .card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
          }

          .card h3 {
            font-size: 1.125rem;
            font-weight: 700;
            color: #212121;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
          }

          .card h3 i {
            color: #1e3c72;
          }

          .info-grid {
            display: grid;
            gap: 1rem;
          }

          .info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #eee;
          }

          .info-item:last-child {
            border-bottom: none;
          }

          .info-item .label {
            color: #757575;
          }

          .info-item .value {
            font-weight: 600;
            color: #212121;
          }

          .timeline {
            position: relative;
            padding-right: 2rem;
          }

          .timeline::before {
            content: '';
            position: absolute;
            right: 7px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
          }

          .timeline-item {
            position: relative;
            padding-bottom: 1.5rem;
          }

          .timeline-dot {
            position: absolute;
            right: -2rem;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e0e0e0;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #e0e0e0;
          }

          .timeline-item.active .timeline-dot {
            background: #4CAF50;
            box-shadow: 0 0 0 2px #4CAF50;
          }

          .timeline-date {
            font-size: 0.875rem;
            color: #757575;
          }

          .timeline-content p {
            font-weight: 600;
            color: #212121;
            margin: 0.25rem 0 0 0;
          }

          .rejection-card {
            grid-column: 1 / -1;
            background: #ffebee;
            border: 1px solid #ffcdd2;
          }

          .rejection-card h3 {
            color: #c62828;
          }

          .rejection-card h3 i {
            color: #c62828;
          }

          .documents-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
          }

          .document-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #f5f5f5;
            border-radius: 0.5rem;
          }

          .doc-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
          }

          .document-item i {
            color: #e53935;
            font-size: 1.25rem;
          }

          .actions-bar {
            display: flex;
            gap: 1rem;
          }

          @media (max-width: 768px) {
            .content-grid {
              grid-template-columns: 1fr;
            }

            .page-header {
              flex-direction: column;
              align-items: flex-start;
            }

            .payment-required-card {
              flex-direction: column;
              text-align: center;
            }
          }

          /* Payment Required Card */
          .payment-required-card {
            display: flex;
            align-items: center;
            gap: 2rem;
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border: 2px solid #ffc107;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
          }

          .payment-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
          }

          .payment-icon i {
            font-size: 2rem;
            color: white;
          }

          .payment-info {
            flex: 1;
          }

          .payment-info h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #e65100;
            margin-bottom: 0.5rem;
          }

          .payment-info p {
            color: #795548;
            margin-bottom: 1rem;
          }

          .payment-amount {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
          }

          .payment-amount .amount {
            font-size: 2.5rem;
            font-weight: 900;
            color: #e65100;
          }

          .payment-amount .currency {
            font-size: 1rem;
            color: #795548;
          }

          .payment-actions {
            text-align: center;
          }

          .btn-pay {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
            color: white;
            font-size: 1.25rem;
            font-weight: 700;
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
          }

          .btn-pay:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
          }

          .payment-note {
            margin-top: 0.75rem;
            font-size: 0.875rem;
            color: #795548;
          }

          /* Status Messages */
          .status-message {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
          }

          .status-message i {
            font-size: 2rem;
          }

          .status-message p {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
          }

          .status-message.success {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 1px solid #4CAF50;
          }

          .status-message.success i,
          .status-message.success p {
            color: #2e7d32;
          }

          .status-message.ready {
            background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
            border: 1px solid #00897b;
          }

          .status-message.ready i,
          .status-message.ready p {
            color: #00695c;
          }

          .status-message.completed {
            background: linear-gradient(135deg, #ede7f6 0%, #d1c4e9 100%);
            border: 1px solid #7e57c2;
          }

          .status-message.completed i,
          .status-message.completed p {
            color: #5e35b1;
          }

          /* Receipt Upload Styles */
          .receipt-upload-card {
            margin-top: 1.5rem;
          }

          .receipt-upload-card h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #1e3c72;
          }

          .receipt-info {
            color: #757575;
            margin-bottom: 1rem;
          }

          .receipt-upload-area {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            background: #fafafa;
          }

          .receipt-upload-area:hover {
            border-color: #1e3c72;
            background: #f0f4ff;
          }

          .receipt-upload-area input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
          }

          .receipt-upload-area .upload-icon {
            font-size: 2.5rem;
            color: #1e3c72;
            margin-bottom: 0.5rem;
          }

          .receipt-upload-area .file-types {
            font-size: 0.85rem;
            color: #9e9e9e;
          }

          .receipt-preview {
            margin: 1rem 0;
          }

          .receipt-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            border: 1px solid #eee;
          }

          .upload-progress {
            margin: 1rem 0;
          }

          .upload-progress.hidden {
            display: none;
          }

          .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
          }

          .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1e3c72, #2a5298);
            width: 0%;
            transition: width 0.3s;
            animation: progressAnim 1.5s ease-in-out infinite;
          }

          @keyframes progressAnim {

            0%,
            100% {
              width: 30%;
              margin-left: 0;
            }

            50% {
              width: 50%;
              margin-left: 50%;
            }
          }

          .progress-text {
            font-size: 0.85rem;
            color: #757575;
            display: block;
            margin-top: 0.5rem;
          }

          .receipt-uploaded {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #e8f5e9;
            border-radius: 8px;
            color: #2e7d32;
          }

          .receipt-uploaded i {
            font-size: 1.5rem;
          }

          #receiptUploadForm button {
            margin-top: 1rem;
          }
        </style>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
        <script src="/js/main.js"></script>
        <script>
          // Receipt upload handling
          const receiptForm = document.getElementById('receiptUploadForm');
          const receiptInput = document.getElementById('paymentReceiptInput');
          const receiptPreview = document.getElementById('receiptPreview');
          const uploadProgress = document.getElementById('uploadProgress');
          const alertContainer = document.getElementById('receiptAlertContainer');
          const uploadBtn = document.getElementById('uploadReceiptBtn');

          if (receiptInput) {
            receiptInput.addEventListener('change', function () {
              if (this.files && this.files[0]) {
                const file = this.files[0];
                if (file.type.startsWith('image/')) {
                  const reader = new FileReader();
                  reader.onload = function (e) {
                    receiptPreview.innerHTML = `<img src="${e.target.result}" alt="Receipt Preview">`;
                  };
                  reader.readAsDataURL(file);
                } else {
                  receiptPreview.innerHTML = `<p><i class="fas fa-file-pdf"></i> ${file.name}</p>`;
                }
              }
            });
          }

          if (receiptForm) {
            receiptForm.addEventListener('submit', async function (e) {
              e.preventDefault();

              if (!receiptInput.files || !receiptInput.files[0]) {
                showReceiptAlert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„', 'danger');
                return;
              }

              const formData = new FormData();
              formData.append('payment_receipt', receiptInput.files[0]);

              uploadProgress.classList.remove('hidden');
              uploadBtn.disabled = true;

              try {
                const response = await axios.post('/api/v1/applications/<%= application.id %>/payment-receipt', formData, {
                  headers: { 'Content-Type': 'multipart/form-data' }
                });

                if (response.data.status === 'success') {
                  showReceiptAlert('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹.', 'success');
                  setTimeout(() => window.location.reload(), 2000);
                }
              } catch (err) {
                showReceiptAlert(err.response?.data?.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„', 'danger');
              } finally {
                uploadProgress.classList.add('hidden');
                uploadBtn.disabled = false;
              }
            });
          }

          function showReceiptAlert(message, type) {
            if (!alertContainer) return;
            const icons = { success: 'check-circle', danger: 'exclamation-circle' };
            alertContainer.innerHTML = `
              <div class="alert alert-${type}" style="margin-top: 1rem; padding: 1rem; border-radius: 8px; background: ${type === 'success' ? '#e8f5e9' : '#ffebee'}; color: ${type === 'success' ? '#2e7d32' : '#c62828'};">
                <i class="fas fa-${icons[type]}"></i> ${message}
              </div>
            `;
          }
        </script>
</body>

</html>